<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Appart Nassim Sarah - Tracker Immo</title>
    <!-- Tailwind CSS pour le style moderne -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM depuis CDN -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel pour le support JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Firebase SDKs pour la sauvegarde Cloud partagée -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        select { -webkit-appearance: none; -moz-appearance: none; appearance: none; }
    </style>
</head>
<body class="bg-[#F8FAFC]">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;
        
        // Initialisation Firebase avec les variables d'environnement obligatoires
        const firebaseConfig = JSON.parse(window.__firebase_config);
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();
        const auth = firebase.auth();
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        const APP_PASSWORD = "chaville2026";

        const STATUS_OPTIONS = [
            { label: "À contacter", color: "bg-slate-100 text-slate-600 border-slate-200" },
            { label: "En attente de visite", color: "bg-amber-100 text-amber-700 border-amber-200" },
            { label: "Déjà visité", color: "bg-blue-100 text-blue-700 border-blue-200" },
            { label: "En cours de négociation", color: "bg-purple-100 text-purple-700 border-purple-200" },
            { label: "Dossier déposé", color: "bg-green-100 text-green-700 border-green-200" },
            { label: "Refusé", color: "bg-red-100 text-red-700 border-red-200" }
        ];

        // Composant d'icônes SVG
        const Icon = ({ name, className = "w-5 h-5", fill = "none", size }) => {
            const dim = size || 24;
            const icons = {
                heart: <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/>,
                plus: <path d="M5 12h14m-7-7v14"/>,
                trash: <path d="M3 6h18m-2 0v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6m3 0V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>,
                pencil: <path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/>,
                external: <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6m4-3h6v6m-11 5L21 3"/>,
                map: <React.Fragment><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></React.Fragment>,
                camera: <React.Fragment><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3Z"/><circle cx="12" cy="13" r="3"/></React.Fragment>,
                search: <React.Fragment><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></React.Fragment>,
                logout: <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4m7 14 5-5-5-5m5 5H9"/>,
                list: <React.Fragment><line x1="8" x2="21" y1="6" y2="6"/><line x1="8" x2="21" y1="12" y2="12"/><line x1="8" x2="21" y1="18" y2="18"/><line x1="3" x2="3.01" y1="6" y2="6"/><line x1="3" x2="3.01" y1="12" y2="12"/><line x1="3" x2="3.01" y1="18" y2="18"/></React.Fragment>,
                grid: <React.Fragment><rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/></React.Fragment>,
                check: <path d="M20 6 9 17l-5-5"/>,
                hammer: <React.Fragment><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a2 2 0 0 1-2.51-2.51L14.7 6.3Z"/><path d="m14.7 6.3 2.8 2.8L12.1 14.5c-.39.39-1.02.39-1.41 0l-1.4-1.4a1 1 0 0 0-1.42 0l-3.3 3.3a2 2 0 0 0 0 2.82l.6.6c.39.39 1.02.39 1.41 0l3.3-3.3c.39-.39.39-1.02 0-1.41l-1.4-1.4 5.3-5.3Z"/></React.Fragment>,
                x: <path d="M18 6 6 18M6 6l12 12"/>
            };
            return (
                <svg xmlns="http://www.w3.org/2000/svg" width={dim} height={dim} viewBox="0 0 24 24" fill={fill} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    {icons[name] || null}
                </svg>
            );
        };

        const App = () => {
            const [user, setUser] = useState(null);
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [passwordInput, setPasswordInput] = useState("");
            const [error, setError] = useState(false);
            const [items, setItems] = useState([]);
            const [loading, setLoading] = useState(true);
            const [searchTerm, setSearchTerm] = useState("");
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [editingItem, setEditingItem] = useState(null);
            const [viewMode, setViewMode] = useState('table');
            const [showFavoritesOnly, setShowFavoritesOnly] = useState(false);

            const [formState, setFormState] = useState({
                ville: "Chaville", quartier: "", prix: 0, surface: 0, pieces: 3, statut: "À contacter", travaux: "Non", lien: "", image: "", notes: "", favori: false
            });

            // Gestion de l'authentification Firebase (Règle 3)
            useEffect(() => {
                const initAuth = async () => {
                    try {
                        if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                            await auth.signInWithCustomToken(__initial_auth_token);
                        } else {
                            await auth.signInAnonymously();
                        }
                    } catch (e) {
                        console.error("Auth error:", e);
                    }
                };
                initAuth();
                const unsubscribe = auth.onAuthStateChanged((u) => {
                    setUser(u);
                    if (sessionStorage.getItem('isAuth') === 'true') {
                        setIsAuthenticated(true);
                    }
                });
                return () => unsubscribe();
            }, []);

            // Récupération des données Firestore (Règle 1)
            useEffect(() => {
                if (!user) return;
                const collectionPath = `/artifacts/${appId}/public/data/appartements`;
                const q = db.collection(collectionPath);
                
                const unsubscribe = q.onSnapshot((snapshot) => {
                    const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    setItems(data);
                    setLoading(false);
                }, (err) => {
                    console.error("Firestore permission error:", err);
                    setLoading(false);
                });
                return () => unsubscribe();
            }, [user]);

            const handleLogin = (e) => {
                e.preventDefault();
                if (passwordInput.toLowerCase() === APP_PASSWORD) {
                    setIsAuthenticated(true);
                    sessionStorage.setItem('isAuth', 'true');
                } else {
                    setError(true);
                    setPasswordInput("");
                }
            };

            const openAddModal = () => {
                setEditingItem(null);
                setFormState({ ville: "Chaville", quartier: "", prix: 0, surface: 0, pieces: 3, statut: "À contacter", travaux: "À vérifier", lien: "", image: "", notes: "", favori: false });
                setIsModalOpen(true);
            };

            const openEditModal = (item) => {
                setEditingItem(item);
                setFormState({ ...item });
                setIsModalOpen(true);
            };

            const handleSave = async () => {
                if (!user) return;
                const collectionPath = `/artifacts/${appId}/public/data/appartements`;
                const data = { ...formState, updatedAt: firebase.firestore.FieldValue.serverTimestamp() };
                
                try {
                    if (editingItem) {
                        await db.collection(collectionPath).doc(editingItem.id).update(data);
                    } else {
                        await db.collection(collectionPath).add(data);
                    }
                    setIsModalOpen(false);
                } catch (e) { console.error("Save error:", e); }
            };

            const deleteItem = async (id) => {
                if (!user || !confirm("Supprimer définitivement ce bien ?")) return;
                const collectionPath = `/artifacts/${appId}/public/data/appartements`;
                await db.collection(collectionPath).doc(id).delete();
            };

            const toggleFavorite = async (item) => {
                if (!user) return;
                const collectionPath = `/artifacts/${appId}/public/data/appartements`;
                await db.collection(collectionPath).doc(item.id).update({ favori: !item.favori });
            };

            const updateStatus = async (id, status) => {
                if (!user) return;
                const collectionPath = `/artifacts/${appId}/public/data/appartements`;
                await db.collection(collectionPath).doc(id).update({ statut: status });
            };

            const stats = useMemo(() => {
                return {
                    total: items.length,
                    favoris: items.filter(i => i.favori).length,
                    visites: items.filter(i => i.statut === "Déjà visité").length,
                    attente: items.filter(i => i.statut === "En attente de visite").length
                };
            }, [items]);

            const filteredItems = items.filter(item => {
                const searchMatch = item.ville.toLowerCase().includes(searchTerm.toLowerCase()) || (item.quartier || "").toLowerCase().includes(searchTerm.toLowerCase());
                return showFavoritesOnly ? (item.favori && searchMatch) : searchMatch;
            });

            if (!isAuthenticated) {
                return (
                    <div className="min-h-screen bg-slate-900 flex items-center justify-center p-4">
                        <div className="max-w-md w-full bg-white rounded-[2rem] shadow-2xl p-10 text-center font-sans">
                            <div className="bg-indigo-600 w-16 h-16 rounded-2xl flex items-center justify-center mx-auto mb-6 text-white shadow-lg shadow-indigo-200">
                                <Icon name="heart" size={32} fill="white" />
                            </div>
                            <h1 className="text-2xl font-black text-slate-900 uppercase tracking-tight">Appart Nassim Sarah</h1>
                            <p className="text-slate-400 text-sm mt-1 font-bold mb-8 uppercase tracking-widest">Accès Privé</p>
                            <form onSubmit={handleLogin} className="space-y-4">
                                <input type="password" placeholder="Mot de passe" className="w-full px-6 py-4 bg-slate-50 border-2 border-transparent rounded-2xl focus:border-indigo-600 focus:outline-none font-bold text-center" value={passwordInput} onChange={e => setPasswordInput(e.target.value)} />
                                {error && <p className="text-red-500 text-xs font-bold uppercase tracking-widest mt-2">Accès refusé</p>}
                                <button type="submit" className="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 rounded-2xl shadow-xl uppercase text-xs tracking-widest transition-all">Se connecter</button>
                            </form>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen pb-20 font-sans">
                    <header className="bg-white/80 backdrop-blur-md border-b border-slate-200 sticky top-0 z-40 px-4 h-16 md:h-20 flex items-center justify-between max-w-7xl mx-auto rounded-b-3xl">
                        <div className="flex items-center gap-3">
                            <div className="bg-indigo-600 p-2 rounded-xl text-white shadow-lg shadow-indigo-100"><Icon name="heart" fill="white" /></div>
                            <div className="hidden xs:block">
                                <h1 className="text-sm md:text-lg font-black uppercase tracking-tight leading-none truncate max-w-[150px] md:max-w-none">Appart <span className="text-indigo-600">Nassim Sarah</span></h1>
                                <p className="text-[8px] md:text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1">Chaville / Viroflay</p>
                            </div>
                        </div>
                        <div className="flex items-center gap-2 md:gap-4">
                            <button onClick={openAddModal} className="bg-indigo-600 hover:bg-indigo-700 text-white px-4 md:px-6 py-2 md:py-3 rounded-xl md:rounded-2xl text-xs md:text-sm font-bold flex items-center gap-2 shadow-lg transition-all">
                                <Icon name="plus" size={16} /> <span className="hidden sm:inline">Nouveau bien</span>
                            </button>
                            <button onClick={() => {sessionStorage.removeItem('isAuth'); setIsAuthenticated(false);}} className="p-2 text-slate-400 hover:text-red-600"><Icon name="logout" /></button>
                        </div>
                    </header>

                    <main className="max-w-7xl mx-auto px-4 py-6 md:py-10">
                        {/* Statistiques Dynamiques */}
                        <div className="grid grid-cols-1 sm:grid-cols-3 gap-4 md:gap-6 mb-8 md:mb-12">
                            <div className="bg-white p-6 rounded-[2rem] border border-slate-100 shadow-sm flex items-center gap-5">
                                <div className="bg-red-50 text-red-500 p-4 rounded-2xl"><Icon name="heart" fill={stats.favoris > 0 ? "currentColor" : "none"} /></div>
                                <div><p className="text-slate-400 text-[10px] font-black uppercase tracking-widest">Favoris</p><p className="text-2xl font-black">{stats.favoris}</p></div>
                            </div>
                            <div className="bg-white p-6 rounded-[2rem] border border-slate-100 shadow-sm flex items-center gap-5">
                                <div className="bg-blue-50 text-blue-600 p-4 rounded-2xl"><Icon name="list" /></div>
                                <div><p className="text-slate-400 text-[10px] font-black uppercase tracking-widest">Annonces</p><p className="text-2xl font-black">{stats.total}</p></div>
                            </div>
                            <div className="bg-white p-6 rounded-[2rem] border border-slate-100 shadow-sm flex items-center gap-5">
                                <div className="bg-emerald-50 text-emerald-600 p-4 rounded-2xl"><Icon name="check" /></div>
                                <div><p className="text-slate-400 text-[10px] font-black uppercase tracking-widest">Visites</p><p className="text-2xl font-black">{stats.visites} / <span className="text-amber-500">{stats.attente}</span></p></div>
                            </div>
                        </div>

                        {/* Filtres et Vues */}
                        <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-8">
                            <h2 className="text-xl md:text-2xl font-black text-slate-800 tracking-tight">Notre Shortlist</h2>
                            <div className="flex flex-wrap items-center gap-3 w-full md:w-auto">
                                <button onClick={() => setShowFavoritesOnly(!showFavoritesOnly)} className={`flex items-center gap-2 px-5 py-3 rounded-2xl text-xs font-bold transition-all border-2 ${showFavoritesOnly ? 'bg-red-50 border-red-200 text-red-600 shadow-md' : 'bg-white border-slate-100 text-slate-400'}`}>
                                    <Icon name="heart" size={16} fill={showFavoritesOnly ? "currentColor" : "none"} /> <span>{showFavoritesOnly ? "Favoris" : "Tout voir"}</span>
                                </button>
                                <div className="relative flex-grow sm:max-w-xs">
                                    <Icon name="search" className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" size={16} />
                                    <input type="text" placeholder="Filtrer..." className="w-full pl-12 pr-6 py-3 bg-white border-none rounded-2xl text-sm shadow-sm focus:ring-2 focus:ring-indigo-500 transition-all font-medium" value={searchTerm} onChange={e => setSearchTerm(e.target.value)} />
                                </div>
                                <div className="flex bg-white rounded-2xl p-1 border border-slate-200 shadow-sm">
                                    <button onClick={() => setViewMode('table')} className={`p-2 rounded-xl transition-all ${viewMode === 'table' ? 'bg-indigo-600 text-white' : 'text-slate-400'}`}><Icon name="list" size={20} /></button>
                                    <button onClick={() => setViewMode('grid')} className={`p-2 rounded-xl transition-all ${viewMode === 'grid' ? 'bg-indigo-600 text-white' : 'text-slate-400'}`}><Icon name="grid" size={20} /></button>
                                </div>
                            </div>
                        </div>

                        {loading ? (
                            <div className="py-20 text-center"><div className="animate-spin w-10 h-10 border-4 border-indigo-600 border-t-transparent rounded-full mx-auto mb-4"></div><p className="text-slate-400 font-bold uppercase text-[10px] tracking-widest">Synchronisation Cloud...</p></div>
                        ) : viewMode === 'table' ? (
                            <div className="bg-white rounded-[2rem] border border-slate-200 shadow-sm overflow-hidden overflow-x-auto">
                                <table className="w-full text-left min-w-[950px]">
                                    <thead>
                                        <tr className="bg-slate-50 border-b border-slate-100 text-slate-400">
                                            <th className="px-8 py-5 text-[10px] font-black uppercase tracking-widest w-12 text-center">Fav</th>
                                            <th className="px-8 py-5 text-[10px] font-black uppercase tracking-widest">Photo</th>
                                            <th className="px-8 py-5 text-[10px] font-black uppercase tracking-widest">Bien / Localisation</th>
                                            <th className="px-8 py-5 text-[10px] font-black uppercase tracking-widest text-center">Budget / M²</th>
                                            <th className="px-8 py-5 text-[10px] font-black uppercase tracking-widest text-center">Surface</th>
                                            <th className="px-8 py-5 text-[10px] font-black uppercase tracking-widest min-w-[220px]">Statut</th>
                                            <th className="px-8 py-5 text-[10px] font-black uppercase tracking-widest text-right">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-slate-50">
                                        {filteredItems.map((item) => (
                                            <tr key={item.id} className="hover:bg-slate-50/50 transition-colors group">
                                                <td className="px-8 py-6 text-center">
                                                    <button onClick={() => toggleFavorite(item)}><Icon name="heart" className={`transition-all ${item.favori ? 'text-red-500 fill-red-500' : 'text-slate-200 hover:text-red-200'}`} fill={item.favori ? "currentColor" : "none"} /></button>
                                                </td>
                                                <td className="px-8 py-6">
                                                    <div className="w-16 h-12 rounded-xl bg-slate-100 overflow-hidden border border-slate-200 flex items-center justify-center">
                                                        {item.image ? <img src={item.image} className="w-full h-full object-cover" /> : <Icon name="camera" className="text-slate-300" size={20} />}
                                                    </div>
                                                </td>
                                                <td className="px-8 py-6">
                                                    <p className="font-bold text-slate-900 text-sm uppercase tracking-tight">{item.ville}</p>
                                                    <p className="text-[10px] text-slate-400 flex items-center gap-1 mt-1 font-bold uppercase tracking-wider"><Icon name="map" size={10} /> {item.quartier || 'Secteur libre'}</p>
                                                </td>
                                                <td className="px-8 py-6 text-center">
                                                    <p className={`font-black text-sm ${Number(item.prix) > 350000 ? 'text-red-500' : 'text-slate-900'}`}>{Number(item.prix).toLocaleString()} €</p>
                                                    <p className="text-[9px] text-indigo-600 font-bold mt-1 uppercase">{item.surface ? Math.round(item.prix/item.surface) : 0}€/m²</p>
                                                </td>
                                                <td className="px-8 py-6 text-center">
                                                    <p className="font-bold text-slate-600 text-sm">{item.surface} m²</p>
                                                    <p className="text-[9px] text-slate-400 font-black uppercase tracking-widest">{item.pieces} pièces</p>
                                                </td>
                                                <td className="px-8 py-6">
                                                    <select value={item.statut} onChange={e => updateStatus(item.id, e.target.value)} className={`w-full text-[10px] font-black uppercase tracking-widest px-4 py-2.5 rounded-xl border-2 transition-all cursor-pointer focus:outline-none ${STATUS_OPTIONS.find(s => s.label === item.statut)?.color}`}>
                                                        {STATUS_OPTIONS.map(opt => <option key={opt.label} value={opt.label}>{opt.label}</option>)}
                                                    </select>
                                                </td>
                                                <td className="px-8 py-6 text-right">
                                                    <div className="flex justify-end gap-2 opacity-100 md:opacity-0 group-hover:opacity-100 transition-opacity">
                                                        <button onClick={() => openEditModal(item)} className="p-3 bg-amber-50 text-amber-600 rounded-2xl hover:bg-amber-100"><Icon name="pencil" size={18} /></button>
                                                        <a href={item.lien} target="_blank" className="p-3 bg-indigo-50 text-indigo-600 rounded-2xl hover:bg-indigo-100"><Icon name="external" size={18} /></a>
                                                        <button onClick={() => deleteItem(item.id)} className="p-3 bg-red-50 text-red-500 rounded-2xl hover:bg-red-100"><Icon name="trash" size={18} /></button>
                                                    </div>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        ) : (
                            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8 font-sans">
                                {filteredItems.map((item) => (
                                    <div key={item.id} className="bg-white rounded-[2.5rem] border border-slate-100 shadow-sm overflow-hidden hover:shadow-xl transition-all group flex flex-col">
                                        <div className="h-52 bg-slate-100 relative overflow-hidden">
                                            {item.image ? <img src={item.image} className="w-full h-full object-cover transition-transform group-hover:scale-105" /> : <div className="w-full h-full flex items-center justify-center text-slate-300"><Icon name="camera" size={48} /></div>}
                                            <div className="absolute top-5 left-5 right-5 flex justify-between z-10">
                                                <button onClick={() => toggleFavorite(item)} className="p-3 bg-white/90 backdrop-blur rounded-2xl shadow-sm"><Icon name="heart" className={item.favori ? 'text-red-500 fill-red-500' : 'text-slate-300'} fill={item.favori ? "currentColor" : "none"} /></button>
                                                <button onClick={() => openEditModal(item)} className="p-3 bg-white/90 backdrop-blur rounded-2xl shadow-sm text-slate-400 hover:text-amber-500"><Icon name="pencil" /></button>
                                            </div>
                                        </div>
                                        <div className="p-8 flex-grow flex flex-col">
                                            <div className="flex justify-between items-start mb-2">
                                                <div><p className="text-indigo-600 font-black text-xl uppercase leading-none">{item.ville}</p><p className="text-slate-400 text-[10px] font-black uppercase tracking-widest mt-2">{item.quartier || 'Secteur libre'}</p></div>
                                                <div className={`px-3 py-1.5 rounded-xl border-2 text-[8px] font-black uppercase tracking-widest ${STATUS_OPTIONS.find(s => s.label === item.statut)?.color}`}>{item.statut}</div>
                                            </div>
                                            <div className={`text-3xl font-black my-4 ${Number(item.prix) > 350000 ? 'text-red-500' : 'text-slate-900'}`}>{Number(item.prix).toLocaleString()} €</div>
                                            <div className="flex items-center gap-2 text-xs font-bold text-slate-500 mb-6 flex-wrap">
                                                <span className="bg-slate-50 px-3 py-2 rounded-xl border border-slate-100">{item.surface} m²</span>
                                                <span className="bg-slate-50 px-3 py-2 rounded-xl border border-slate-100">{item.pieces}p</span>
                                                <span className="ml-auto text-indigo-600 font-black">{item.surface ? Math.round(item.prix/item.surface) : 0}€/m²</span>
                                            </div>
                                            <div className="p-5 bg-slate-50 rounded-2xl text-[11px] text-slate-500 italic mb-8 min-h-[80px] leading-relaxed border border-slate-100 text-center flex items-center justify-center font-sans">"{item.notes || 'Pas de commentaires...'}"</div>
                                            <div className="mt-auto flex gap-2">
                                                <a href={item.lien} target="_blank" className="flex-1 bg-slate-900 text-white text-center py-4 rounded-2xl font-bold text-[10px] uppercase tracking-widest shadow-lg shadow-slate-100 hover:bg-black transition-all">Voir l'annonce</a>
                                                <button onClick={() => deleteItem(item.id)} className="p-4 bg-red-50 text-red-500 rounded-2xl hover:bg-red-100 transition-colors"><Icon name="trash" /></button>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </main>

                    {isModalOpen && (
                        <div className="fixed inset-0 bg-slate-900/60 backdrop-blur-md z-50 flex items-end sm:items-center justify-center p-0 sm:p-4 animate-in fade-in duration-300">
                            <div className="bg-white rounded-t-[2.5rem] sm:rounded-[3.5rem] w-full max-w-2xl max-h-[95vh] shadow-2xl overflow-y-auto p-6 md:p-12 relative custom-scrollbar">
                                <button onClick={() => setIsModalOpen(false)} className="absolute top-8 right-8 text-slate-300 hover:text-slate-500"><Icon name="plus" className="rotate-45" size={32} /></button>
                                <h2 className="text-3xl font-black mb-2 tracking-tight text-slate-900 uppercase">Bien Immobilier</h2>
                                <p className="text-slate-400 font-bold text-[10px] uppercase tracking-widest mb-10">Projet Nassim & Sarah</p>
                                
                                <div className="space-y-6">
                                    <div className="grid grid-cols-1 sm:grid-cols-2 gap-6">
                                        <div><label className="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-5 mb-2 block">Lien de la photo</label><div className="relative"><input type="url" placeholder="https://..." className="w-full p-5 bg-slate-50 rounded-2xl border-none focus:ring-4 focus:ring-indigo-100 font-medium text-xs text-slate-900" value={formState.image} onChange={e => setFormState({...formState, image: e.target.value})} /><Icon name="camera" size={18} className="absolute right-5 top-1/2 -translate-y-1/2 text-slate-300" /></div></div>
                                        <div><label className="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-5 mb-2 block">Lien de l'annonce</label><input type="url" placeholder="SeLoger, LeBonCoin..." className="w-full p-5 bg-slate-50 rounded-2xl border-none focus:ring-4 focus:ring-indigo-100 font-medium text-xs text-slate-900" value={formState.lien} onChange={e => setFormState({...formState, lien: e.target.value})} /></div>
                                    </div>

                                    <div className="grid grid-cols-1 sm:grid-cols-2 gap-6">
                                        <div><label className="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-5 mb-2 block">Ville</label><select className="w-full p-5 bg-slate-50 rounded-2xl border-none font-bold text-sm text-slate-900" value={formState.ville} onChange={e => setFormState({...formState, ville: e.target.value})}><option>Chaville</option><option>Viroflay</option></select></div>
                                        <div><label className="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-5 mb-2 block">Quartier précis</label><input type="text" placeholder="Rive Droite, Atrium..." className="w-full p-5 bg-slate-50 rounded-2xl border-none focus:ring-4 focus:ring-indigo-100 font-bold text-sm text-slate-900" value={formState.quartier} onChange={e => setFormState({...formState, quartier: e.target.value})} /></div>
                                    </div>

                                    <div className="grid grid-cols-3 gap-6">
                                        <div><label className="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-5 mb-2 block text-[8px]">Prix (€)</label><input type="number" className="w-full p-5 bg-slate-50 rounded-2xl border-none font-black text-lg text-slate-900" value={formState.prix} onChange={e => setFormState({...formState, prix: Number(e.target.value)})} /></div>
                                        <div><label className="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-5 mb-2 block text-[8px]">Surf (m²)</label><input type="number" className="w-full p-5 bg-slate-50 rounded-2xl border-none font-black text-lg text-slate-900" value={formState.surface} onChange={e => setFormState({...formState, surface: Number(e.target.value)})} /></div>
                                        <div><label className="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-5 mb-2 block text-[8px]">Pièces</label><input type="number" className="w-full p-5 bg-slate-50 rounded-2xl border-none font-black text-lg text-slate-900" value={formState.pieces} onChange={e => setFormState({...formState, pieces: Number(e.target.value)})} /></div>
                                    </div>

                                    <div className="grid grid-cols-1 sm:grid-cols-2 gap-6">
                                        <div><label className="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-5 mb-2 block">Travaux</label><input type="text" placeholder="Non, Rafraîchissement..." className="w-full p-5 bg-slate-50 rounded-2xl border-none font-bold text-sm text-slate-900" value={formState.travaux} onChange={e => setFormState({...formState, travaux: e.target.value})} /></div>
                                        <div className="flex items-end"><button type="button" onClick={() => setFormState({...formState, favori: !formState.favori})} className={`flex items-center justify-center gap-3 px-6 py-5 rounded-2xl font-bold text-xs uppercase tracking-widest transition-all w-full border-2 ${formState.favori ? 'bg-red-50 text-red-500 border-red-100 shadow-sm' : 'bg-slate-100 text-slate-400 border-transparent'}`}><Icon name="heart" fill={formState.favori ? "currentColor" : "none"} /> {formState.favori ? "Coup de cœur" : "Mettre en favori"}</button></div>
                                    </div>

                                    <div><label className="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-5 mb-2 block">Notes de Nassim & Sarah</label><textarea className="w-full p-5 bg-slate-50 border-none rounded-3xl h-24 md:h-32 text-xs md:text-sm font-medium leading-relaxed text-slate-900" placeholder="L'exposition, les charges, le feeling..." value={formState.notes} onChange={e => setFormState({...formState, notes: e.target.value})} /></div>

                                    <div className="flex flex-col sm:flex-row gap-4 mt-8 pb-4">
                                        <button type="button" onClick={() => setIsModalOpen(false)} className="order-2 sm:order-1 flex-1 py-5 font-bold text-slate-400 uppercase text-[10px] tracking-widest hover:text-slate-600 transition-colors">Annuler</button>
                                        <button type="button" onClick={handleSave} className="order-1 sm:order-2 flex-1 py-5 bg-indigo-600 text-white font-black rounded-[2rem] shadow-xl shadow-indigo-100 hover:bg-indigo-700 transition-all uppercase text-[10px] tracking-widest">
                                            {editingItem ? "Mettre à jour" : "Sauvegarder"}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
